<source>
  @type forward
  port 24224
</source>

<match **>
  @type s3
  s3_bucket "#{ENV['S3_BUCKET']}"
  s3_region "#{ENV['S3_REGION']}"
  path ${tag}/
  s3_object_key_format %{path}%{time_slice}_%{index}.%{file_extension}
  use_server_side_encryption AES256
  store_as gzip_command

  s3_endpoint http://s3mock:9090/ # s3mock server
  force_path_style true           # s3mock server

  <buffer tag,time>
    @type file
    path /var/log/fluent/s3
    timekey 10
    timekey_wait 0s
  </buffer>
</match>
